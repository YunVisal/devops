name: "SSH into instance"

on:
  workflow_dispatch:

jobs:
  ssh:
    runs-on: ubuntu-latest
    steps:
      # - name: start ssh-agent
      #   uses: webfactory/ssh-agent@v0.9.0
      #   with:
      #     ssh-private-key: ${{ secrets.SSH_KEY }}

      # - name: add host key
      #   run: ssh-keyscan -t rsa ${{ secrets.INSTANCE_HOST }} >> ~/.ssh/known_hosts

      - name: Add key
        run: |
          mkdir -p ~/.ssh
          echo "${{secrets.SSH_KEY}}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -H "${{secrets.SSH_KEY}}" >> ~/.ssh/known_hosts

      - name: ssh into server
        run: ssh ${{secrets.INSTANCE_USER}}:${{vars.INSTANCE_HOST}} "ls -la"
